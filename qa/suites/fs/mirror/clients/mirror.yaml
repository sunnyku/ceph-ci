meta:
- desc: configure the permissions for client.mirror
overrides:
  ceph:
    conf:
      client:
        debug cephfs_mirror: 20
        log to stderr: false
      # make these predictable
      client.mirror.0:
        admin socket: /var/run/ceph/cephfs-mirror.$cluster-$name.asok
        pid file: /var/run/ceph/cephfs-mirror.$cluster-$name.pid
      client.mirror.1:
        admin socket: /var/run/ceph/cephfs-mirror.$cluster-$name.asok
        pid file: /var/run/ceph/cephfs-mirror.$cluster-$name.pid
      client.mirror.2:
        admin socket: /var/run/ceph/cephfs-mirror.$cluster-$name.asok
        pid file: /var/run/ceph/cephfs-mirror.$cluster-$name.pid
      client.mirror.3:
        admin socket: /var/run/ceph/cephfs-mirror.$cluster-$name.asok
        pid file: /var/run/ceph/cephfs-mirror.$cluster-$name.pid
tasks:
- exec:
    cluster1.client.mirror.0:
      - "sudo ceph --cluster cluster1 auth caps client.mirror mon 'allow r' mds 'allow r' osd 'allow rw object_prefix cephfs_mirror' mgr 'allow r'"
      - "sudo ceph --cluster cluster1 auth caps client.mirror.0 mon 'allow r' mds 'allow r' osd 'allow rw object_prefix cephfs_mirror' mgr 'allow r'"
      - "sudo ceph --cluster cluster1 auth caps client.mirror.1 mon 'allow r' mds 'allow r' osd 'allow rw object_prefix cephfs_mirror' mgr 'allow r'"
      - "sudo ceph --cluster cluster1 auth caps client.mirror.2 mon 'allow r' mds 'allow r' osd 'allow rw object_prefix cephfs_mirror' mgr 'allow r'"
      - "sudo ceph --cluster cluster1 auth caps client.mirror.3 mon 'allow r' mds 'allow r' osd 'allow rw object_prefix cephfs_mirror' mgr 'allow r'"
